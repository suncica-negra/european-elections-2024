const isMob=window.innerWidth<900;let loaderWrapper=null;function getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function setLiveOrNot(e){const t=document.querySelector(".live");t&&!e&&(t.style.visibility="hidden")}function fixTooltipPosition(){const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);e&&document.documentElement.style.setProperty("--textShadow","0 0 1.3px #090909");const t=document.querySelectorAll(".tooltip_wrapper .tooltip");let n=t;isMob&&(n=Array.from(t).filter(((e,t)=>t>1))),n?.forEach((t=>{e&&t.classList.add("after_safari");const n=t.getBoundingClientRect();if(n&&n.x+n.width>window.innerWidth){const n=t.parentNode;n&&(n.style.left="unset",n.style.right=isMob?"80%":"90%",n.style.setProperty("--tooltipPadding","10px 20px 10px 5px")),t.classList.add("hide_after","display_before"),e&&t.classList.add("hide_after","display_before_safari")}}))}function percentToPixel(e){return e/100*104+39}function pluralizeVotes(e){if(!e)return"";const t=e.toString();return t.endsWith("1")&&!t.endsWith("11")?"":["2","3","4"].some((e=>t.endsWith(e)))?"A":"OVA"}function placeDataInHtml(e){const t=document.getElementById("election_results");t.replaceChildren();const n=[...e.lista];e["list-bez-mandata"]&&n.push(...e["list-bez-mandata"]);let o=1e6;const a=[];n?.forEach((e=>{a.push(Number(e.glasova))})),o=Math.max(...a);const r=new DocumentFragment;if(isMob){const e=document.createElement("div");e.setAttribute("class","first_empty"),r.appendChild(e)}if(n?.forEach((e=>{const t=e.config,n=document.createElement("div");n.setAttribute("class","party_result_wrapper");const a=document.createElement("p");a.textContent=t?t.short_name:e.naziv,a.setAttribute("class","party"),n.appendChild(a);const s=document.createElement("p"),l=e.brMandata?e.brMandata:0;s.textContent=l;const i=document.createElement("span");i.textContent=l.toString().endsWith("1")&&11!==l?"MANDAT":"MANDATA",s.appendChild(i);const d=document.createElement("span"),c=e.glasova,p=pluralizeVotes(c);d.textContent=`${Number(c).toLocaleString("hr-HR")} GLAS${p}`,s.appendChild(d);const u=document.createElement("div");let m=Number(c)/o*100;m<1&&(m=1);const h=percentToPixel(m);setTimeout((()=>{u.style.height=`${m}%`,s.style.bottom=`${h}px`}),150);const f=t&&t.color?t.color:getRandomColor();u.style.backgroundColor=f,t&&t.hover?(u.style.setProperty("--graphHover",t.hover),u.style.filter="unset"):u.style.setProperty("--graphHover",f),u.setAttribute("class","graph");const b=document.createElement("div");if(b.setAttribute("class","graph_wrapper"),b.appendChild(u),n.appendChild(b),n.appendChild(s),l>0){const t=document.createElement("div");t.setAttribute("class","tooltip_wrapper scrollable_wrapper");const o=document.createElement("div");o.setAttribute("class","tooltip"),t.appendChild(o);const a=document.createElement("table"),r=document.getElementById("tooltip_table_header").content.cloneNode(!0);a.appendChild(r);const s=e.lista;s?.forEach((e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=Number(e.glasova).toLocaleString("hr-HR"),t.appendChild(n);const o=document.createElement("td");o.textContent=e.naziv,t.appendChild(o),a.appendChild(t)}));const l=document.createElement("div");l.setAttribute("class","table_wrapper vertical_scrollbox"),l.appendChild(a),o.appendChild(l),n.appendChild(t)}r.appendChild(n)})),isMob){const e=document.createElement("div");e.setAttribute("class","last_empty"),r.appendChild(e)}t.appendChild(r),fixTooltipPosition(),loaderWrapper&&(loaderWrapper.style.display="none")}function setProcessedVotesAndLastChange(e,t,n=!0){const o=document.getElementById("processed_votes_and_last_change");if(!o)return;n&&o.replaceChildren();const a=document.getElementById("processed_votes_and_last_change_template").content.cloneNode(!0),r=a.getElementById("processed_votes");r.textContent=`${t}%`+r.textContent;const s=a.getElementById("last_change"),l=e?.split(":"),i=l?.map((e=>e.padStart(2,"0")));s.textContent+=`${i?.join(":")} H`,o.appendChild(a)}function autoRefresh(){loaderWrapper&&(loaderWrapper.style.display="block"),getElectionsData(!0)}async function getElectionsData(e=!1){urlBase="https://showcase.24sata.hr/izbori2024/";const t=new URLSearchParams(window.location.search).get("json");url=`${urlBase}${t||"eu-elections-2024.json"}`,fetch(url).then((e=>{if(e.ok)return e.json()})).then((t=>{if(e)return setLiveOrNot(t.live),setProcessedVotesAndLastChange(t.vrijeme,t.bmObradjenoPosto),void(loaderWrapper&&(loaderWrapper.style.display="none"));if(loaderWrapper=document.querySelector(".loader_wrapper"),setLiveOrNot(t.live),setProcessedVotesAndLastChange(t.vrijeme,t.bmObradjenoPosto,!1),placeDataInHtml(t),t.live){const e=t.interval||6e4;setInterval(autoRefresh,e)}})).catch((e=>{console.error(`[Elections widget] Election results data were not retrieved due to: \n${e}`)}))}function debounce(e,t){let n=null;return function(){const o=this,a=arguments;clearTimeout(n),n=setTimeout((()=>{e.apply(o,a)}),t)}}document.addEventListener("DOMContentLoaded",(()=>{getElectionsData()})),window.addEventListener("resize",debounce((()=>{window.innerWidth<900!==isMob&&window.location.reload()}),200));
