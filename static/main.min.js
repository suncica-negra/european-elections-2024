const isMob=window.innerWidth<900;let loaderWrapper=null;function getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function setLiveOrNot(e){const t=document.querySelector(".live");t&&!e&&(t.style.visibility="hidden")}function fixTooltipPosition(){const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);e&&document.documentElement.style.setProperty("--textShadow","0 0 1.3px #090909");const t=document.querySelectorAll(".tooltip_wrapper .tooltip");t?.forEach((t=>{if(e&&t.classList.add("after_safari"),!isMob){const n=t.getBoundingClientRect();if(n&&n.x+n.width>window.innerWidth){const n=t.parentNode;n&&(n.style.left="unset",n.style.right="90%",n.style.setProperty("--tooltipPadding","10px 20px 10px 5px")),t.classList.add("hide_after","display_before"),e&&t.classList.add("hide_after","display_before_safari")}}}))}function percentToPixel(e){return e/100*104+39}function pluralizeVotes(e){return e?e.endsWith("1")&&!e.endsWith("11")?"":["2","3","4"].some((t=>e.endsWith(t)))?"A":"OVA":""}function placeDataInHtml(e){document.getElementById("election_results").replaceChildren();const t=[...e.lista];e["list-bez-mandata"]&&t.push(...e["list-bez-mandata"]);let n=1e6;const o=[];t?.forEach((e=>{o.push(Number(e.glasova))})),n=Math.max(...o);const a=new DocumentFragment;t?.forEach((e=>{const t=e.config,o=document.createElement("div");o.setAttribute("class","party_result_wrapper");const s=document.createElement("p");s.textContent=t?t.short_name:e.naziv,s.setAttribute("class","party"),o.appendChild(s);const r=document.createElement("p"),l=e.brMandata?e.brMandata:0;r.textContent=l;const i=document.createElement("span");i.textContent=l.toString().endsWith("1")&&11!==l?"MANDAT":"MANDATA",r.appendChild(i);const d=document.createElement("span"),c=e.glasova.toString(),p=pluralizeVotes(c);d.textContent=`${c.replace(/\B(?=(\d{3})+(?!\d))/g,".")} GLAS${p}`,r.appendChild(d);const u=document.createElement("div");let h=e.glasova/n*100;h<1&&(h=1);const m=percentToPixel(h);setTimeout((()=>{u.style.height=`${h}%`,r.style.bottom=`${m}px`}),150);const g=t&&t.color?t.color:getRandomColor();u.style.backgroundColor=g,t&&t.hover?(u.style.setProperty("--graphHover",t.hover),u.style.filter="unset"):u.style.setProperty("--graphHover",g),u.setAttribute("class","graph");const f=document.createElement("div");if(f.setAttribute("class","graph_wrapper"),f.appendChild(u),o.appendChild(f),o.appendChild(r),l>0){const t=document.createElement("div");t.setAttribute("class","tooltip_wrapper scrollable_wrapper");const n=document.createElement("div");n.setAttribute("class","tooltip");const a=document.createElement("p");a.textContent="Detalji:",n.appendChild(a),t.appendChild(n);const s=document.createElement("ul");let r=e.lista;r?.forEach((e=>{const t=document.createElement("li");t.textContent=`${e.naziv} - `;const n=pluralizeVotes(e.glasova.toString()),o=document.createElement("strong");o.textContent=`${e.glasova} glas${n.toLocaleLowerCase()}`,t.appendChild(o),s.appendChild(t)})),n.appendChild(s),o.appendChild(t)}a.appendChild(o)}));document.getElementById("election_results").appendChild(a),fixTooltipPosition(),loaderWrapper&&(loaderWrapper.style.display="none")}function setProcessedVotesAndLastChange(e,t=!0){const n=document.getElementById("processed_votes_and_last_change");if(!n)return;t&&n.replaceChildren();const o=document.getElementById("processed_votes_and_last_change_template").content.cloneNode(!0),a=o.getElementById("processed_votes");a.textContent=`${e?.bmPosto}%`+a.textContent;const s=o.getElementById("last_change"),r=(e?.vrijeme)?.split(":"),l=r?.map((e=>e.padStart(2,"0")));s.textContent+=`${l?.join(":")} H`,n.appendChild(o)}function autoRefresh(){loaderWrapper&&(loaderWrapper.style.display="block"),getElectionsData(!0)}async function getElectionsData(e=!1){url="https://showcase.24sata.hr/izbori2024/eu-elections-2024_v3.json",fetch(url).then((e=>{if(e.ok)return e.json()})).then((t=>{if(e)return setLiveOrNot(t.live),setProcessedVotesAndLastChange(t.status),void(loaderWrapper&&(loaderWrapper.style.display="none"));if(loaderWrapper=document.querySelector(".loader_wrapper"),setLiveOrNot(t.live),setProcessedVotesAndLastChange(t.status,!1),placeDataInHtml(t),t.live){const e=t.interval||6e4;setInterval(autoRefresh,e)}})).catch((e=>{console.error(`[Elections widget] Election results data were not retrieved due to: \n${e}`)}))}function debounce(e,t){let n=null;return function(){const o=this,a=arguments;clearTimeout(n),n=setTimeout((()=>{e.apply(o,a)}),t)}}document.addEventListener("DOMContentLoaded",(()=>{getElectionsData()})),window.addEventListener("resize",debounce((()=>{window.innerWidth<900!==isMob&&window.location.reload()}),200));