const isMob=window.innerWidth<900;let loaderWrapper=null;function getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function setLiveOrNot(e){const t=document.querySelector(".live");t&&!e&&(t.style.visibility="hidden")}function fixTooltipPosition(){const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);e&&document.documentElement.style.setProperty("--textShadow","0 0 1.3px #090909");const t=document.querySelectorAll(".tooltip_wrapper .tooltip");t?.forEach((t=>{if(e&&t.classList.add("after_safari"),!isMob){const n=t.getBoundingClientRect();if(n&&n.x+n.width>window.innerWidth){const n=t.parentNode;n&&(n.style.left="unset",n.style.right="90%",n.style.setProperty("--tooltipPadding","10px 20px 10px 5px")),t.classList.add("hide_after","display_before"),e&&t.classList.add("hide_after","display_before_safari")}}}))}function percentToPixel(e){return e/100*104+39}function pluralizeVotes(e){return e?e.endsWith("1")&&!e.endsWith("11")?"":["2","3","4"].some((t=>e.endsWith(t)))?"A":"OVA":""}function placeDataInHtml(e){document.getElementById("election_results").replaceChildren();const t=[...e.lista];e["list-bez-mandata"]&&t.push(...e["list-bez-mandata"]);let n=1e6;const o=[];t?.forEach((e=>{o.push(Number(e.glasova))})),n=Math.max(...o);const a=new DocumentFragment;t?.forEach((e=>{const t=e.config,o=document.createElement("div");o.setAttribute("class","party_result_wrapper");const r=document.createElement("p");r.textContent=t?t.short_name:e.naziv,r.setAttribute("class","party"),o.appendChild(r);const s=document.createElement("p"),l=e.brMandata?e.brMandata:0;s.textContent=l;const d=document.createElement("span");d.textContent=l.toString().endsWith("1")&&11!==l?"MANDAT":"MANDATA",s.appendChild(d);const i=document.createElement("span"),c=e.glasova.toString(),p=pluralizeVotes(c);i.textContent=`${c.replace(/\B(?=(\d{3})+(?!\d))/g,".")} GLAS${p}`,s.appendChild(i);const u=document.createElement("div");let m=e.glasova/n*100;m<1&&(m=1);const h=percentToPixel(m);setTimeout((()=>{u.style.height=`${m}%`,s.style.bottom=`${h}px`}),150);const g=t&&t.color?t.color:getRandomColor();u.style.backgroundColor=g,t&&t.hover?(u.style.setProperty("--graphHover",t.hover),u.style.filter="unset"):u.style.setProperty("--graphHover",g),u.setAttribute("class","graph");const f=document.createElement("div");if(f.setAttribute("class","graph_wrapper"),f.appendChild(u),o.appendChild(f),o.appendChild(s),l>0){const t=document.createElement("div");t.setAttribute("class","tooltip_wrapper scrollable_wrapper");const n=document.createElement("div");n.setAttribute("class","tooltip"),t.appendChild(n);const a=document.createElement("table"),r=document.getElementById("tooltip_table_header").content.cloneNode(!0);a.appendChild(r);const s=e.lista;s?.forEach((e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=e.glasova,t.appendChild(n);const o=document.createElement("td");o.textContent=e.naziv,t.appendChild(o),a.appendChild(t)}));const l=document.createElement("div");l.setAttribute("class","table_wrapper"),l.appendChild(a),n.appendChild(l),o.appendChild(t)}a.appendChild(o)}));document.getElementById("election_results").appendChild(a),fixTooltipPosition(),loaderWrapper&&(loaderWrapper.style.display="none")}function setProcessedVotesAndLastChange(e,t,n=!0){const o=document.getElementById("processed_votes_and_last_change");if(!o)return;n&&o.replaceChildren();const a=document.getElementById("processed_votes_and_last_change_template").content.cloneNode(!0),r=a.getElementById("processed_votes");r.textContent=`${t}%`+r.textContent;const s=a.getElementById("last_change"),l=e?.split(":"),d=l?.map((e=>e.padStart(2,"0")));s.textContent+=`${d?.join(":")} H`,o.appendChild(a)}function autoRefresh(){loaderWrapper&&(loaderWrapper.style.display="block"),getElectionsData(!0)}async function getElectionsData(e=!1){urlBase="https://showcase.24sata.hr/izbori2024/";const t=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).json;url=`${urlBase}${t||"eu-elections-2024.json"}`,fetch(url).then((e=>{if(e.ok)return e.json()})).then((t=>{if(e)return setLiveOrNot(t.live),setProcessedVotesAndLastChange(t.vrijeme,t.bmObradjenoPosto),void(loaderWrapper&&(loaderWrapper.style.display="none"));if(loaderWrapper=document.querySelector(".loader_wrapper"),setLiveOrNot(t.live),setProcessedVotesAndLastChange(t.vrijeme,t.bmObradjenoPosto,!1),placeDataInHtml(t),t.live){const e=t.interval||6e4;setInterval(autoRefresh,e)}})).catch((e=>{console.error(`[Elections widget] Election results data were not retrieved due to: \n${e}`)}))}function debounce(e,t){let n=null;return function(){const o=this,a=arguments;clearTimeout(n),n=setTimeout((()=>{e.apply(o,a)}),t)}}document.addEventListener("DOMContentLoaded",(()=>{getElectionsData()})),window.addEventListener("resize",debounce((()=>{window.innerWidth<900!==isMob&&window.location.reload()}),200));
